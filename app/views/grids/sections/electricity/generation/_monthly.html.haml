- base_title = "#{@grid.name.titleize} Energy Profile"
- years          = MonthlyGeneration.available_years_for(@grid)
- selected_year  = params[:year].presence&.to_i || years.first
- chart_id = "monthly-prod-chart"

/ Wrapper: Now clearly a "Widget"
#monthly_generation-chart-wrapper{
  data: {
    controller: "widget-update",
    widget_update: {
      charts_value: [
        { 
          id: chart_id, 
          url: generation_monthly_grid_charts_path(@grid),
          baseTitle: base_title,
          param: "year"
        }
      ].to_json
    }
  }
}
  - if years.size > 1
    .d-flex.align-items-center.gap-2.mb-2
      %label.form-label.me-2.mb-0{ for: "monthly-generation-year" } Year:

      / Select: triggers the 'update' action
      %select#monthly-generation-year.form-select.form-select-sm.w-auto{
        data: { action: "change->widget-update#update" }
      }
        - years.each do |y|
          %option{ value: y, selected: y == selected_year }= y

  = column_chart generation_monthly_grid_charts_path(@grid, year: selected_year), 
    id: chart_id,
    ytitle: 'Generation (MWh)', 
    suffix: ' MWh',
    colors: [color(:blue)],
    download: {filename: base_title.parameterize}