- id_prefix = panel[:prefix]
- frame_id  = "#{id_prefix}_frame"
- param_key = panel[:param]

= turbo_frame_tag frame_id, class: "d-flex flex-column" do
  .p-2
    = render 'searches/advanced/search_input',
      url: search_advanced_path,
      name: :"q_#{id_prefix}",
      frame: frame_id,
      placeholder: "Find #{panel[:title]}..."

  .d-flex.ps-4
    .flex-grow-1
      - if panel[:items].any?
        - selected_ids = Array(params[param_key]).map(&:to_s)

        - panel[:items].each do |item|
          - val = item.send(panel[:lookup]).to_s
          - lbl = panel[:label_method].is_a?(Proc) ? panel[:label_method].call(item) : (item.respond_to?(panel[:label_method]) ? item.send(panel[:label_method]) : "District #{item.try(:district)}")

          .form-check.mb-1
            = check_box_tag "#{param_key}[]", val, selected_ids.include?(val),
              id: "#{id_prefix}_#{val}",
              class: 'form-check-input',
              form: 'filter-form'
            = label_tag "#{id_prefix}_#{val}", lbl, class: 'form-check-label small'

        - if local_assigns[:pagy] && pagy.pages > 1
          .py-2.d-flex.justify-content-center.small-pagy
            != pagy.series_nav(:bootstrap, link_extra: "data-turbo-frame='#{frame_id}'")
            

      - else
        .text-center.py-4.small.text-muted No results found.

    .facet-alphabet-nav.d-flex.flex-column.align-items-center.bg-light.border-start
      -# RESET BUTTON: Clears the alphabetical filter for this specific panel
      = link_to search_advanced_path(params.permit!.merge(:"alpha_#{id_prefix}" => nil, expanded: panel[:id])),
        class: "alphabet-link fw-bold text-decoration-none text-aedg-navy mb-2",
        title: "Reset to All",
        data: { turbo_frame: frame_id } do
        %i.bi.bi-arrow-clockwise{ style: "font-size: 1.1rem; -webkit-text-stroke: 0.5px;" }

      -# A-Z LINKS
      - ('A'..'Z').each do |letter|
        - is_active = params[:"alpha_#{id_prefix}"] == letter
        = link_to letter, search_advanced_path(params.permit!.merge(:"alpha_#{id_prefix}" => letter, expanded: panel[:id])),
          class: "alphabet-link fw-bold text-decoration-none #{'active' if is_active}",
          data: { turbo_frame: frame_id }