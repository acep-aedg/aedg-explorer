= form_with url: search_advanced_path, method: :get, local: true, html: { id: 'advanced-search-form' } do |f|
  .card-body.p-1.bg-light
    -# --- Search box ---
    
    .input-group.bg-white.search-bar.ps-4
      = f.text_field :q, value: @query, class: "form-control border-0", placeholder: "Search for a community..."
      - if @query.present?
        = link_to search_advanced_path, class: 'btn btn-white border-0' do
          %i.bi.bi-x.text-secondary

    - reset_disabled = params.except(:controller, :action).blank?

    / Apply and Reset (top)
    .d-grid.gap-1.py-2.bg-light
      = f.submit 'Apply', class: 'btn btn-warning btn-sm btn-block'
      = link_to 'Clear all', search_advanced_path,
        class: "btn btn-secondary btn-sm #{'disabled' if reset_disabled}",
        aria: { disabled: reset_disabled }

    / Facets
    %ul.list-group.list-group-flush.small
      = render 'searches/advanced/facet_list', title: 'Grids',              items: @all_grids, param_key: :grid_ids,                     id_prefix: 'grid', top_n: 6, value_of: ->(g){ g.id }, label_of: ->(g){ g.name }
      = render 'searches/advanced/facet_list', title: 'Boroughs',           items: @all_boros, param_key: :borough_fips_codes,           id_prefix: 'bor',  top_n: 6, value_of: ->(b){ b.fips_code }, label_of: ->(b){ b.name }
      = render 'searches/advanced/facet_list', title: 'Native Corporations',items: @all_corps, param_key: :regional_corporation_fips_codes, id_prefix: 'corp', top_n: 6, value_of: ->(c){ c.fips_code }, label_of: ->(c){ c.name }
      = render 'searches/advanced/facet_list', title: 'Senate Districts',   items: @all_senate, param_key: :senate_district_ids,         id_prefix: 'sen',  top_n: 6, value_of: ->(d){ d.id }, label_of: ->(d){ d }
      = render 'searches/advanced/facet_list', title: 'House Districts',    items: @all_house, param_key: :house_district_ids,           id_prefix: 'hou',  top_n: 6, value_of: ->(d){ d.id }, label_of: ->(d){ d }

    / Apply and Reset (bottom)
    .d-grid.gap-1.py-2.bg-light
      = f.submit 'Apply', class: 'btn btn-warning btn-sm'
      = link_to 'Clear all', search_advanced_path,
        class: "btn btn-secondary btn-sm #{'disabled' if reset_disabled}",
        aria: { disabled: reset_disabled }
