- content_for :title, 'Advanced Search'

.container-fluid
  .row
    / ==== LEFT: FILTERS PANEL ====
    .col-lg-4.p-0.bg-light
      .card.rounded-0
        = render 'searches/advanced/form'

    / ==== RIGHT: MAIN RESULTS ====
    .col-lg.p-0{ style: "min-height: 100vh;" }
      .bg-body-secondary.rounded-0.p-4.w-100.d-flex.flex-column{ style: "height: 100%; overflow-y: auto;" }

        / --- Header and filter badges ---
        .d-flex.flex-wrap.justify-content-between.align-items-center.mb-3
          %h2.h5.mb-0= pluralize(@pagy.count, 'Community')

          - selected_grids = selected_labels(@all_grids, :grid_ids) { |g| g.id }
          - selected_boros = selected_labels(@all_boros, :borough_fips_codes) { |b| b.fips_code }
          - selected_corps = selected_labels(@all_corps, :regional_corporation_fips_codes) { |c| c.fips_code }
          - selected_sen   = selected_labels(@all_senate, :senate_district_ids) { |d| d.id }
          - selected_hou   = selected_labels(@all_house, :house_district_ids) { |d| d.id }

          - if selected_grids.any? || selected_boros.any? || selected_corps.any? || selected_sen.any? || selected_hou.any? || params[:q].present?
            .d-flex.flex-wrap.gap-2
              - if params[:q].present?
                %span.badge.bg-primary-subtle.text-primary.border
                  %i.bi.bi-search.me-1.mb-1
                  = params[:q]
              - selected_grids.each do |g|
                %span.badge.bg-light.text-body.border
                  %i.bi.bi-grid-3x3-gap.me-1.mb-1
                  = g.name
              - selected_boros.each do |b|
                %span.badge.bg-secondary.text-light= b.name
              - selected_corps.each do |c|
                %span.badge.bg-success.text-light= c.name
              - selected_sen.each do |d|
                %span.badge.bg-info-subtle.text-dark.border= "Senate District #{d.district}"
              - selected_hou.each do |d|
                %span.badge.bg-primary-subtle.text-primary.border= "House District #{d}"

            = link_to 'Clear all', search_advanced_path, class: 'small ms-2 text-decoration-none'

        / --- Scrollable results ---
        .flex-grow-1.overflow-auto
          - if @pagy.count > 0
            .vstack.gap-3
              - @communities.each do |community|
                = render 'searches/advanced/community_card', community: community
            .mt-4.text-center
              = raw(pagy_bootstrap_nav(@pagy))
          - else
            .alert.alert-info.text-center.mt-3
              No communities matched those filters. Try broadening your selection.
